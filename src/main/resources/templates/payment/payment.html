<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>SBLAND</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="/css/sbland.css">
	<script src="https://cdn.iamport.kr/js/iamport.payment-1.1.8.js"></script>
</head>
<body>
	<div id="wrap">
		<section class="contents d-flex justify-content-center align-items-center">
			<div id="paymentWrap">
				<h1>주문정보</h1>
				<p>결제 금액: <span th:text="${session.paymentInfo}"></span>원</p>
				<button id="payment-button">결제하기</button>
			</div>
				
		</section>	
	</div>
	
	<script th:inline="javascript">
	    var merchantUid = /*[[${merchantUid}]]*/ 'default_merchant_uid';
	    var amount = /*[[${amount}]]*/ 0;
	    var buyerName = /*[(${#httpServletRequest.session.getAttribute('userSession').name}]*/ "언노운유저";
	    var orderDetail = /*[[${orderDetailMapList}]]*/ [];
	    var impKey = /*[[(${impKey}]]*/ "";
	</script>
	<script>
	    $(document).ready(function () {
	        const IMP = window.IMP; 
	        IMP.init(impKey); 
	
	        $('#payment-button').click(function () {
	        	return
	            IMP.request_pay({
	                pg: 'html5_inicis' 
	                ,pay_method: 'card'
	                ,merchant_uid: merchantUid
	                ,name: '상품 결제'
	                ,amount: amount
	                ,buyer_name: buyerName
	            }
	            , function (rsp) {
	                if (rsp.success) {
	                    alert('결제가 완료되었습니다.');
	                    location.href = '/payment/result';
	                } else {
	                    alert('결제에 실패했습니다. 에러: ' + rsp.error_msg);
	                }
	            });
	        });
	    });
	</script>
</body>
</html>